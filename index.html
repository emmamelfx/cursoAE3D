<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CURSO DE AFTER EFFECTS EXPERTO</title>

  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="%2344C4F2"/>
      <stop offset="1" stop-color="%23766BF5"/>
    </linearGradient>
  </defs>
  <rect width="128" height="128" rx="28" fill="url(%23g)"/>
  <text x="50%" y="56%" font-family="Arial, Helvetica, sans-serif" font-size="58" font-weight="900" fill="%23ffffff" text-anchor="middle">EM</text>
</svg>' />

  <style>
    :root{
      --bg:#0b0d12;
      --bg2:#0f1320;
      --surface:rgba(255,255,255,.06);
      --surface2:rgba(255,255,255,.09);
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.20);

      --text:#f4f6ff;
      --muted:#c6cbe2;
      --muted2:#8e97bb;

      /* Colores logo EM */
      --accent:#44C4F2;
      --accent2:#766BF5;

      --ok:#30d158;
      --softRed:#ff6b6b;

      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);
      --r12:12px;
      --r16:16px;
      --r20:20px;
      --max: 1240px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1100px 600px at 15% -10%, rgba(68,196,242,.22), transparent 60%),
        radial-gradient(900px 520px at 85% -10%, rgba(118,107,245,.18), transparent 60%),
        radial-gradient(800px 520px at 50% 110%, rgba(68,196,242,.10), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }

    body, h1, h2, h3, p, span, b, small, div, button, a, input, label, textarea { color: var(--text); }
    a{ text-decoration:none; }

    .container{max-width:var(--max); margin:0 auto; padding:18px 16px 28px;}

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(11,13,18,.68);
      border-bottom:1px solid var(--stroke);
    }
    .topbar-inner{
      max-width:var(--max);
      margin:0 auto;
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }

    .brand{display:flex; align-items:center; gap:10px; min-width:240px;}
    .logoWrap{
      width:42px; height:42px; border-radius:16px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 16px 34px rgba(68,196,242,.18);
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.12);
    }
    .logoWrap span{font-weight: 900; font-size: 18px; color:#fff; letter-spacing:.4px;}
    .brand .t{display:flex; flex-direction:column; line-height:1.12}
    .brand .t b{font-size:15px; letter-spacing:.2px}
    .brand .t span{font-size:14px; color:var(--muted2)}

    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      font-size:14px;
      padding:8px 10px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius:999px;
      color: var(--muted);
      box-shadow: var(--shadow2);
      user-select:none;
    }
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      font-size:14px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .08s ease, border-color .12s ease, background .12s ease;
      user-select:none;
      color:#fff;
    }
    .btn:hover{transform: translateY(-1px); border-color: var(--stroke2); background: rgba(255,255,255,.08)}
    .btn.accent{
      border-color: rgba(68,196,242,.35);
      background: linear-gradient(135deg, rgba(68,196,242,.22), rgba(118,107,245,.12));
      color: #fff;
    }
    .btn.solid{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: rgba(68,196,242,.40);
      color:#fff; /* pedido: texto blanco sobre degradado */
      font-weight: 900;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 16px;
      align-items:start;
      margin-top:16px;
    }

    .card{
      background: rgba(255,255,255,.05);
      border: 1px solid var(--stroke);
      border-radius: var(--r20);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    /* HERO */
    .hero{
      padding: 18px 18px 16px;
      background:
        radial-gradient(900px 520px at 10% 0%, rgba(68,196,242,.16), transparent 55%),
        radial-gradient(900px 520px at 90% 0%, rgba(118,107,245,.14), transparent 55%),
        rgba(255,255,255,.04);
      border-bottom: 1px solid var(--stroke);
    }
    .hero .kicker{
      display:inline-flex; align-items:center; gap:10px;
      font-size:15px;
      color: var(--muted);
      padding: 6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
    .kickerIcon{width:18px; height:18px; display:inline-block;}
    h1{margin:10px 0 0; font-size: 25px; letter-spacing: .2px; line-height:1.15;}
    .sub{margin:10px 0 0; color: var(--muted); font-size: 16px; line-height:1.7; max-width: 92ch;}

    .hero-row{
      margin-top: 14px;
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .kpis{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .kpi{
      min-width: 190px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
    .kpi b{font-size:14px}
    .kpi span{display:block; margin-top:2px; font-size:14px; color:var(--muted2)}

    .progressWrap{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .bar{
      width:min(420px, 100%);
      height: 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .bar > div{
      width:0%;
      height:100%;
      background: linear-gradient(90deg, var(--accent), #e5edff);
      border-radius:999px;
      transition: width .25s ease;
    }
    .barText{font-size:14px; color: var(--muted2); font-family: var(--mono);}

    /* Video Home */
    .homeVideoWrap{
      margin-top: 14px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.35);
      box-shadow: var(--shadow2);
    }
    .homeVideo{width:100%; aspect-ratio:16/9; background:#070911;}
    iframe{width:100%; height:100%; border:0}

    /* Player */
    .playerWrap{padding:14px;}
    .player{
      width:100%;
      aspect-ratio:16/9;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid var(--stroke);
      background:#070911;
      box-shadow: var(--shadow2);
    }

    .lessonMeta{
      padding: 0 14px 14px;
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
      align-items:flex-start;
    }
    .lessonMeta h2{margin:0; font-size:18px; letter-spacing:.2px}
    .lessonMeta p{margin:8px 0 0; color: var(--muted); font-size:15px; line-height:1.55}
    .navBtns{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;}

    /* Sidebar */
    .sideHead{
      padding: 14px 14px 12px;
      border-bottom: 1px solid var(--stroke);
      display:flex; flex-direction:column; gap:6px;
    }
    .sideHead b{font-size:15px}
    .sideHead span{font-size:14px; color: var(--muted2)}

    .search{padding: 12px 14px; border-bottom:1px solid var(--stroke); background: rgba(255,255,255,.03);}
    .search input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text) !important;
      outline:none;
      font-size: 14px;
    }
    .search input::placeholder{ color: rgba(198,203,226,.55); }

    .module{
      margin: 10px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    .moduleHead{
      padding: 10px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      cursor:pointer; user-select:none;
    }
    .moduleHead b{font-size:14px}
    .moduleHead span{font-size:14px; color: var(--muted2)}
    .moduleHead:hover{background: rgba(255,255,255,.04)}
    .moduleBody{padding: 0 8px 10px;}

    .lessonBtn{
      width:100%;
      text-align:left;
      display:flex; gap:10px; align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: transparent;
      cursor:pointer;
      transition: background .12s ease, border-color .12s ease, transform .08s ease;
      margin-top: 6px;
    }
    .lessonBtn:hover{
      background: rgba(68,196,242,.10);
      border-color: rgba(68,196,242,.18);
      transform: translateY(-1px);
    }
    .lessonBtn.active{
      background: rgba(68,196,242,.14);
      border-color: rgba(68,196,242,.22);
    }

    /* Pedido: circulo verde y si fue visto pasa a rojo suave */
    .badge{
      width: 38px; height: 38px;
      border-radius: 999px;
      display:grid; place-items:center;
      font-family: var(--mono);
      font-size:14px;
      border:1px solid rgba(48,209,88,.35);
      background: rgba(48,209,88,.14); /* verde */
      color: #d8ffe3;
      flex:0 0 auto;
      font-weight: 900;
    }
    .badge.done{
      border-color: rgba(255,107,107,.32);
      background: rgba(255,107,107,.16); /* rojito suave */
      color: #ffe1e1;
    }

    .lt{margin:0; font-size:15px; font-weight:900; line-height:1.25;}
    .ld{margin:4px 0 0; font-size:14px; color: var(--muted2); line-height:1.35;}

    /* Overlay panel (encima del home) */
    .overlay{
      position:absolute;
      inset: 14px;
      border-radius: 18px;
      border: 1px solid rgba(68,196,242,.35);
      background: rgba(10,12,18,.72);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 60px rgba(0,0,0,.50);
      display:none;
      overflow:hidden;
      z-index: 20;
    }
    .overlay.show{display:block;}
    .overlayHead{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .overlayHead b{font-size:16px}
    .overlayBody{padding: 14px; max-height: calc(100% - 54px); overflow:auto;}
    .closeBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 900;
    }
    .closeBtn:hover{border-color: rgba(255,255,255,.24);}

    /* Tabs en el main */
    .tabsRow{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .tabBtn{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      font-size: 14px;
      color: var(--muted);
    }
    .tabBtn.primary{
      border-color: rgba(68,196,242,.40);
      background: linear-gradient(135deg, rgba(68,196,242,.18), rgba(118,107,245,.10));
      color:#fff;
    }
    .tabBtn:hover{border-color: rgba(255,255,255,.24);}

    /* Chips/temas */
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(68,196,242,.28);
      background: rgba(68,196,242,.10);
      font-size: 14px;
      margin-right: 8px;
      margin-bottom: 8px;
      cursor:pointer;
      font-weight: 900;
    }
    .chip:hover{border-color: rgba(68,196,242,.40);}

    /* Formularios */
    .formGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .field input, .field textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      outline:none;
      font-size: 14px;
      color: var(--text) !important;
    }
    .field textarea{ min-height: 140px; resize: vertical; grid-column: 1 / -1; }
    .field input::placeholder, .field textarea::placeholder{ color: rgba(198,203,226,.55); }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .brand{min-width:0}
      .kpi{min-width:150px}
      .formGrid{ grid-template-columns: 1fr; }
      .overlay{ inset: 10px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logoWrap" aria-hidden="true"><span>EM</span></div>
        <div class="t">
          <b>CURSO DE AFTER EFFECTS EXPERTO</b>
          <span>Acceso por link ¬∑ 19 videos / 20 clases</span>
        </div>
      </div>

      <div class="actions">
        <span class="pill" id="pillProgress">Progreso 0%</span>
        <button class="btn accent" id="openPanelHome" type="button">üìö Panel</button>
        <button class="btn accent" id="goHome" type="button">üè† Inicio</button>
        <a class="btn" id="openYT" href="#" target="_blank" rel="noopener">‚ñ∂ Abrir en YouTube</a>
        <button class="btn solid" id="toggleDone" type="button">‚úÖ Completar</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="grid">

      <!-- MAIN -->
      <main class="card" id="mainCard">

        <!-- HOME -->
        <section class="hero" id="homeSection">
          <div class="kicker">
            <svg class="kickerIcon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M4 8h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8Z" stroke="currentColor" stroke-width="2" opacity=".9"/>
              <path d="M4 8l2-4h14l-2 4H4Z" stroke="currentColor" stroke-width="2" opacity=".9"/>
              <path d="M8 4l-2 4M14 4l-2 4M20 4l-2 4" stroke="currentColor" stroke-width="2" opacity=".9"/>
            </svg>
            Workshop ¬∑ After Effects ¬∑ Entorno 3D
          </div>

          <h1>After Effects ¬∑ Nivel Experto</h1>

          <p class="sub">
            Hola! bienvenido al curso de After effects nivel experto, donde aprenderas todas las tecnicas avanzadas para mejorar tus skills como dise√±ador audiovisual, aprenderas todos sobre el entorno 3D para que tus dise√±os de motion graphics esten a la altura de las grandes agencias creativas. A tu derecha tendras la lista con todos los videos del curso, podras verlos las veces que quieras.
          </p>

          <div class="hero-row">
            <div class="kpis">
              <div class="kpi"><b id="kpiLessons">‚Äî</b><span>Contenido total</span></div>
              <div class="kpi"><b id="kpiDone">‚Äî</b><span>Completadas</span></div>
            </div>

            <div class="progressWrap">
              <div class="bar"><div id="progressFill"></div></div>
              <span class="barText" id="progressText">0 / 0</span>
              <button class="btn solid" id="startBtn" type="button">‚ñ∂ Empezar</button>
            </div>
          </div>

          <!-- Video bienvenida SOLO en Home -->
          <div class="homeVideoWrap">
            <div class="homeVideo">
              <iframe
                src="https://www.youtube.com/embed/ptSPBlNyoQ8?rel=0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            </div>
          </div>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="tabBtn" id="btnTopics" type="button">üß© Grupo de temas</button>
            <button class="tabBtn primary" id="btnDownloads" type="button"><b>Descargas de recursos:</b>&nbsp;Proyecto + recursos gr√°ficos</button>
            <button class="tabBtn primary" id="btnComments" type="button">üí¨ Comentarios</button>
          </div>
        </section>

        <!-- Overlay (encima del home) -->
        <section class="overlay" id="overlay">
          <div class="overlayHead">
            <b id="overlayTitle">Panel</b>
            <button class="closeBtn" id="closeOverlay" type="button">‚úï</button>
          </div>
          <div class="overlayBody" id="overlayBody"></div>
        </section>

        <!-- PLAYER (al elegir una clase el HOME desaparece) -->
        <section id="playerSection" style="display:none;">
          <div class="playerWrap">
            <div class="player">
              <iframe id="frame"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            </div>
          </div>

          <div class="lessonMeta">
            <div class="left">
              <h2 id="lessonTitle">Eleg√≠ una clase</h2>
              <p id="lessonDesc">Seleccion√° una clase del listado para comenzar.</p>
            </div>
            <div class="navBtns">
              <button class="btn" id="prevBtn" type="button">‚¨Ö Anterior</button>
              <button class="btn" id="nextBtn" type="button">Siguiente ‚û°</button>
            </div>
          </div>
        </section>
      </main>

      <!-- SIDEBAR -->
      <aside class="card" style="position:sticky; top:78px;">
        <div class="sideHead">
          <b>Clases</b>
          <span id="sideSub">Clases del curso</span>
        </div>

        <div class="search">
          <input id="q" type="search" placeholder="Buscar‚Ä¶ (ej: c√°mara, 3D, export, part√≠culas)" />
        </div>

        <div id="modules"></div>
      </aside>

    </div>
  </div>

  <script>
    // ====== Config Descargas ======
    const DOWNLOADS_LINK = "https://drive.google.com/drive/folders/1JwAskl-_V1mdrx0JIWpMMnkqJdgiq4yX?usp=drive_link";

    // ====== Videos del curso (19 videos reales para 20 clases: 05+06 juntos) ======
    const urls = [
      "https://youtu.be/D1IC09GeKZs",
      "https://youtu.be/HVBjwflEPBA",
      "https://youtu.be/4USqAIWAIqc",
      "https://youtu.be/LaMZVjZ1se4",
      "https://youtu.be/wyMZ_Equajc",
      "https://youtu.be/Ghydv5lH-hU",
      "https://youtu.be/Jwr5WONsrnw",
      "https://youtu.be/kIUfed9wwzs",
      "https://youtu.be/2eifWwbYoVU",
      "https://youtu.be/YRVPlf9Q8b8",
      "https://youtu.be/6iZKgA6W2XA",
      "https://youtu.be/5Kf3hmlzw7s",
      "https://youtu.be/OHG0WslMs8M",
      "https://youtu.be/8jx3xiaeruY",
      "https://youtu.be/JoGWgePrkeA",
      "https://youtu.be/Kb5NjjzP8ZU",
      "https://youtu.be/I4njR2qgrZI",
      "https://youtu.be/Q5wg_VyTQ-o",
      "https://youtu.be/bZlzz87AVo4" // Resultado final
    ];

    const lessons = [
      { t:"01 - Introducci√≥n", d:"Breve introducci√≥n al curso.", u:0 },
      { t:"02 - Retos de entorno 3D", d:"Arrancamos el workshop y el enfoque del entorno 3D.", u:1 },
      { t:"03 - Objetivos", d:"Qu√© vas a lograr y c√≥mo vamos a trabajarlo.", u:2 },
      { t:"04 - Manos a la obra", d:"Setup y primeros pasos del proyecto.", u:3 },
      { t:"05 y 06 - Photoshop", d:"Preparaci√≥n de recursos y ajustes (ambas clases en un solo video).", u:4 },
      { t:"07 - Interfaz express de AE", d:"Ajustes clave y setup inicial en After Effects.", u:5 },
      { t:"08 - Interfaz de AE 3D Cam", d:"Trabajo con c√°mara 3D y herramientas principales.", u:6 },
      { t:"09 - Import y Composici√≥n de la estructura 3D", d:"Importaci√≥n y armado de la estructura en la comp.", u:7 },
      { t:"10 - Animaci√≥n de c√°mara 3D I", d:"Primer tramo de animaci√≥n con c√°mara 3D.", u:8 },
      { t:"11 - Animaci√≥n de c√°mara 3D II", d:"Continuaci√≥n: refinamos timing y movimientos.", u:9 },
      { t:"12 - Animaci√≥n interna", d:"Microanimaciones y vida dentro del entorno.", u:10 },
      { t:"13 - Animaci√≥n de t√≠tulos", d:"Dise√±o y animaci√≥n de t√≠tulos integrados.", u:11 },
      { t:"14 - Composici√≥n y Timing", d:"Ajustes globales de comp y ritmo.", u:12 },
      { t:"15 - Efectos de lighting", d:"Look final: profundidad, atm√≥sfera e iluminaci√≥n.", u:13 },
      { t:"16 - Efectos de Part√≠culas 3D", d:"Part√≠culas para elevar el impacto visual.", u:14 },
      { t:"17 - Retoques de Composici√≥n", d:"Retoques finales de post y composici√≥n.", u:15 },
      { t:"18 - Optimizaci√≥n del proyecto", d:"Orden, rendimiento y limpieza del proyecto.", u:16 },
      { t:"19 - Export Final", d:"Exportaci√≥n final y entrega.", u:17 },
      { t:"20 - Visualizaci√≥n y an√°lisis", d:"Cierre y an√°lisis del resultado.", u:18 }
    ];

    // M√≥dulos corregidos (Look & Post incluye 15/16/17, Entrega incluye 18/19)
    const modules = [
      { id:"m1", name:"Inicio del Workshop", items:[0,1,2,3] },
      { id:"m2", name:"Preparaci√≥n de recursos", items:[4] },
      { id:"m3", name:"After Effects + Estructura 3D", items:[5,6,7] },
      { id:"m4", name:"Animaci√≥n", items:[8,9,10,11,12,13] },
      { id:"m5", name:"Look & Post", items:[14,15,16] },    // 15-17 (0-based 14-16)
      { id:"m6", name:"Entrega", items:[17,18] },           // 18-19 (0-based 17-18)
    ];

    // Resultado final: separada
    const finalBlock = { id:"final", name:"Resultado final", items:[19] };

    // ====== DOM ======
    const modulesWrap = document.getElementById("modules");
    const q = document.getElementById("q");
    const frame = document.getElementById("frame");

    const homeSection = document.getElementById("homeSection");
    const playerSection = document.getElementById("playerSection");

    const lessonTitle = document.getElementById("lessonTitle");
    const lessonDesc = document.getElementById("lessonDesc");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const startBtn = document.getElementById("startBtn");

    const openYT = document.getElementById("openYT");
    const goHome = document.getElementById("goHome");
    const toggleDone = document.getElementById("toggleDone");

    const progressFill = document.getElementById("progressFill");
    const progressText = document.getElementById("progressText");
    const pillProgress = document.getElementById("pillProgress");
    const kpiLessons = document.getElementById("kpiLessons");
    const kpiDone = document.getElementById("kpiDone");
    const sideSub = document.getElementById("sideSub");

    // overlay controls
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayBody = document.getElementById("overlayBody");
    const closeOverlay = document.getElementById("closeOverlay");

    const btnTopics = document.getElementById("btnTopics");
    const btnDownloads = document.getElementById("btnDownloads");
    const btnComments = document.getElementById("btnComments");
    const openPanelHome = document.getElementById("openPanelHome");

    // ====== Progreso (manual) ======
    const STORAGE_KEY = "aula_em_experto_v3";
    const progress = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

    function saveProgress(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
      updateProgressUI();
      renderModules(currentTerm);
      updateDoneButton();
    }
    function completedCount(){ return Object.values(progress).filter(Boolean).length; }

    function updateProgressUI(){
      const total = lessons.length; // 20 clases
      const done = completedCount();
      const pct = total ? Math.round((done/total)*100) : 0;

      progressFill.style.width = pct + "%";
      progressText.textContent = `${done} / ${total}`;
      pillProgress.textContent = `Progreso ${pct}%`;
      kpiLessons.textContent = `${total} clases`;
      kpiDone.textContent = `${done} completadas`;
      sideSub.textContent = `${total} clases ¬∑ ${pct}% completado`;
    }

    function toEmbed(url){
      const u = new URL(url);
      const v = u.searchParams.get("v");
      if(v) return `https://www.youtube.com/embed/${v}?rel=0`;
      const parts = u.pathname.split("/").filter(Boolean);
      if(parts.length) return `https://www.youtube.com/embed/${parts[0]}?rel=0`;
      return "";
    }

    let currentLesson = null;
    let currentTerm = "";

    function showHome(){
      homeSection.style.display = "";
      playerSection.style.display = "none";
      currentLesson = null;
      frame.src = "";
      openYT.href = "#";
      toggleDone.textContent = "‚úÖ Completar";
      document.querySelectorAll(".lessonBtn").forEach(b => b.classList.remove("active"));
      hideOverlay();
    }

    function showPlayer(){
      // al entrar a una clase: ocultamos home (incluye video bienvenida)
      homeSection.style.display = "none";
      playerSection.style.display = "";
      hideOverlay();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function updateDoneButton(){
      if(currentLesson === null){ toggleDone.textContent = "‚úÖ Completar"; return; }
      const isDone = !!progress[currentLesson];
      toggleDone.textContent = isDone ? "‚Ü© Marcar pendiente" : "‚úÖ Marcar completada";
    }

    function playLesson(i){
      const l = lessons[i];
      currentLesson = i;
      showPlayer();

      const url = urls[l.u];
      frame.src = toEmbed(url);
      lessonTitle.textContent = l.t;
      lessonDesc.textContent = l.d || " ";
      openYT.href = url;

      document.querySelectorAll(".lessonBtn").forEach(b => b.classList.remove("active"));
      const btn = document.querySelector(`.lessonBtn[data-i="${i}"]`);
      if(btn) btn.classList.add("active");

      updateDoneButton();
    }

    function renderModules(term=""){
      modulesWrap.innerHTML = "";
      const t = term.trim().toLowerCase();

      function addModule(mod){
        const filteredItems = mod.items.filter(i => {
          if(!t) return true;
          const l = lessons[i];
          return (l.t || "").toLowerCase().includes(t) || (l.d || "").toLowerCase().includes(t);
        });
        if(t && filteredItems.length === 0) return;

        const modEl = document.createElement("div");
        modEl.className = "module";
        modEl.dataset.mid = mod.id;

        const head = document.createElement("div");
        head.className = "moduleHead";

        const left = document.createElement("div");
        left.innerHTML = `<b>${mod.name}</b><span style="display:block;margin-top:2px;">${filteredItems.length} clases</span>`;

        const right = document.createElement("span");
        right.textContent = "‚ñº";
        right.style.color = "var(--muted2)";

        head.appendChild(left);
        head.appendChild(right);

        const body = document.createElement("div");
        body.className = "moduleBody";
        body.dataset.body = "1";

        filteredItems.forEach((i) => {
          const l = lessons[i];
          const btn = document.createElement("button");
          btn.className = "lessonBtn";
          btn.type = "button";
          btn.dataset.i = i;

          const badge = document.createElement("div");
          badge.className = "badge" + (progress[i] ? " done" : "");
          badge.textContent = String(i+1).padStart(2,"0");

          const wrap = document.createElement("div");
          wrap.innerHTML = `<p class="lt">${l.t}</p><p class="ld">${l.d || " "}</p>`;

          btn.appendChild(badge);
          btn.appendChild(wrap);
          btn.onclick = () => playLesson(i);

          body.appendChild(btn);
        });

        let open = true;
        head.onclick = () => {
          open = !open;
          body.style.display = open ? "" : "none";
          right.textContent = open ? "‚ñº" : "‚ñ∂";
        };

        modEl.appendChild(head);
        modEl.appendChild(body);
        modulesWrap.appendChild(modEl);
      }

      modules.forEach(addModule);
      addModule(finalBlock);

      if(currentLesson !== null){
        const btn = document.querySelector(`.lessonBtn[data-i="${currentLesson}"]`);
        if(btn) btn.classList.add("active");
      }
    }

    // ====== Overlay ======
    function showOverlay(title, html){
      overlayTitle.textContent = title;
      overlayBody.innerHTML = html;
      overlay.classList.add("show");
    }
    function hideOverlay(){
      overlay.classList.remove("show");
    }
    closeOverlay.onclick = hideOverlay;

    // acciones overlay
    btnDownloads.onclick = () => {
      showOverlay("Descargas de recursos: Proyecto + recursos gr√°ficos", `
        <div style="font-size:14px;color:var(--muted);line-height:1.55;margin-bottom:12px;">
          Acced√© a la carpeta con el proyecto de After Effects y los recursos gr√°ficos.
        </div>
        <a class="btn solid" href="${DOWNLOADS_LINK}" target="_blank" rel="noopener">‚¨á Abrir carpeta de descargas</a>
      `);
    };

    btnComments.onclick = () => {
      showOverlay("Comentarios", `
        <form action="https://formsubmit.co/emmamel.fx@gmail.com" method="POST">
          <input type="hidden" name="_subject" value="Nuevo comentario del curso (Aula privada)" />
          <input type="hidden" name="_captcha" value="false" />
          <input type="hidden" name="_template" value="table" />
          <div class="formGrid" style="margin-top:6px;">
            <div class="field"><input name="Nombre" placeholder="Tu nombre" required /></div>
            <div class="field"><input name="Email" type="email" placeholder="Tu email" required /></div>
            <div class="field"><textarea name="Mensaje" placeholder="Escrib√≠ tu comentario o consulta..." required></textarea></div>
          </div>
          <div style="margin-top:12px;">
            <button class="btn solid" type="submit">üì© Enviar comentario</button>
          </div>
        </form>
      `);
    };

    // Grupo de temas: chips que hacen scroll/expand al m√≥dulo derecho
    btnTopics.onclick = () => openTopicsOverlay();

    openPanelHome.onclick = () => openTopicsOverlay();

    function openTopicsOverlay(){
      const chips = [
        { label:"Inicio del Workshop", mid:"m1" },
        { label:"Preparaci√≥n de recursos", mid:"m2" },
        { label:"AE + Estructura 3D", mid:"m3" },
        { label:"Animaci√≥n", mid:"m4" },
        { label:"Look & Post", mid:"m5" },
        { label:"Entrega", mid:"m6" },
        { label:"Resultado final", mid:"final" },
      ];

      const chipsHtml = chips.map(c => `<button class="chip" type="button" data-mid="${c.mid}">${c.label}</button>`).join("");

      showOverlay("Grupo de temas", `
        <div style="font-size:14px;color:var(--muted);line-height:1.55;margin-bottom:12px;">
          Eleg√≠ un tema y te llevo directo a ese bloque en la lista de la derecha.
        </div>
        <div>${chipsHtml}</div>
      `);

      overlayBody.querySelectorAll("[data-mid]").forEach(btn=>{
        btn.addEventListener("click", () => {
          const mid = btn.getAttribute("data-mid");
          focusModule(mid);
          hideOverlay();
        });
      });
    }

    function focusModule(mid){
      const target = document.querySelector(`.module[data-mid="${mid}"]`);
      if(!target) return;

      // expandir body si estaba cerrado (miramos si est√° oculto)
      const body = target.querySelector('.moduleBody');
      if(body && body.style.display === "none"){
        // click en header para abrir
        target.querySelector('.moduleHead')?.click();
      }

      // scroll hacia el m√≥dulo
      target.scrollIntoView({ behavior:"smooth", block:"start" });
      // mini highlight
      target.style.boxShadow = "0 0 0 2px rgba(68,196,242,.25), 0 18px 50px rgba(0,0,0,.35)";
      setTimeout(()=> target.style.boxShadow = "", 900);
    }

    // ====== Events ======
    goHome.onclick = showHome;
    startBtn.onclick = () => playLesson(0);

    prevBtn.onclick = () => {
      if(currentLesson === null) return;
      playLesson(Math.max(0, currentLesson - 1));
    };
    nextBtn.onclick = () => {
      if(currentLesson === null) return;
      playLesson(Math.min(lessons.length - 1, currentLesson + 1));
    };

    toggleDone.onclick = () => {
      if(currentLesson === null) return;
      progress[currentLesson] = !progress[currentLesson];
      saveProgress();
    };

    q.addEventListener("input", () => {
      currentTerm = q.value;
      renderModules(currentTerm);
    });

    // ====== Init ======
    updateProgressUI();
    renderModules("");
    showHome();
  </script>
</body>
</html>
